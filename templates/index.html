<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Betting Game - Demo</title>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            background: #1a1a2e;
            color: #eee;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        h1 {
            text-align: center;
            margin-bottom: 30px;
            color: #ffd700;
        }
        
        .user-info {
            background: #16213e;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .balance {
            font-size: 20px;
            font-weight: bold;
            color: #4ecca3;
        }
        
        .games-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .game-card {
            background: #16213e;
            border-radius: 10px;
            padding: 20px;
            border: 2px solid #4ecca3;
            position: relative;
        }
        
        .game-card.silver { border-color: #c0c0c0; }
        .game-card.gold { border-color: #ffd700; }
        .game-card.diamond { border-color: #b9f2ff; }
        .game-card.platinum { border-color: #e5e4e2; }
        .game-card.roulette { border-color: #ff6b6b; }
        
        .game-header {
            text-align: center;
            margin-bottom: 15px;
        }
        
        .game-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .game-info {
            font-size: 14px;
            color: #aaa;
        }
        
        .timer-section {
            background: #0f3460;
            padding: 15px;
            border-radius: 5px;
            text-align: center;
            margin-bottom: 15px;
        }
        
        .timer {
            font-size: 28px;
            font-weight: bold;
            color: #4ecca3;
        }
        
        .timer.result-time {
            color: #ffd700;
        }
        
        .round-info {
            font-size: 12px;
            color: #aaa;
            margin-top: 5px;
        }
        
        .winning-number {
            background: #4ecca3;
            color: #000;
            padding: 15px;
            border-radius: 5px;
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 15px;
            display: none;
        }
        
        .winning-number.show {
            display: block;
            animation: highlight 0.5s;
        }
        
        @keyframes highlight {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .number-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .number-grid.roulette-grid {
            grid-template-columns: repeat(7, 1fr);
        }
        
        .number-btn {
            padding: 15px;
            border: 2px solid #4ecca3;
            background: #0f3460;
            color: #fff;
            font-size: 18px;
            font-weight: bold;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .number-btn.roulette-btn {
            padding: 10px;
            font-size: 14px;
        }
        
        .number-btn:hover:not(:disabled) {
            background: #4ecca3;
            color: #000;
            transform: scale(1.05);
        }
        
        .number-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .number-btn.selected {
            background: #ffd700;
            color: #000;
            border-color: #ffd700;
        }
        
        .your-bets {
            background: #0f3460;
            padding: 12px;
            border-radius: 5px;
            margin-bottom: 15px;
            min-height: 40px;
        }
        
        .bets-label {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 8px;
            color: #4ecca3;
        }
        
        .bet-numbers {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .bet-badge {
            background: #ffd700;
            color: #000;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
        }
        
        .all-bets-list {
            background: #0f3460;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
            max-height: 120px;
            overflow-y: auto;
            font-size: 13px;
        }
        
        .bet-item {
            padding: 5px;
            margin-bottom: 3px;
            background: #16213e;
            border-radius: 3px;
            display: flex;
            justify-content: space-between;
        }
        
        .bet-item.bot-bet {
            opacity: 0.6;
            font-style: italic;
        }
        
        .bet-item.winning {
            background: #4ecca3;
            color: #000;
            opacity: 1;
        }
        
        .slots-info {
            text-align: center;
            margin-bottom: 12px;
            font-size: 13px;
            color: #aaa;
        }
        
        .message {
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 10px;
            text-align: center;
            font-size: 13px;
        }
        
        .error {
            background: #c41e3a;
            display: none;
        }
        
        .success {
            background: #4ecca3;
            color: #000;
            display: none;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
        }
        
        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: #16213e;
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid #c41e3a;
            max-width: 300px;
        }
        
        .modal-content h2 {
            color: #c41e3a;
            margin-bottom: 15px;
        }
        
        .modal-content p {
            margin-bottom: 20px;
            font-size: 16px;
        }
        
        .modal-btn {
            background: #4ecca3;
            color: #000;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
            font-size: 14px;
        }
        
        .modal-btn:hover {
            background: #3db599;
        }
    </style>
</head>
<body>
    <div class="modal" id="maxBetsModal">
        <div class="modal-content">
            <h2>‚ö†Ô∏è Maximum Bets Reached</h2>
            <p>Maximum 4 bets are allowed per user</p>
            <button class="modal-btn" onclick="closeModal()">OK</button>
        </div>
    </div>

    <div class="container">
        <h1>üéÆ Betting Game - Live Demo</h1>
        
        <div class="user-info">
            <div>
                <strong>User:</strong> <span id="username">Player</span>
            </div>
            <div class="balance">
                üí∞ Balance: <span id="balance">0</span> Coins
            </div>
        </div>
        
        <div class="games-container">
            <div class="game-card silver" data-game="silver">
                <div class="game-header">
                    <div class="game-title">ü•à Silver Game</div>
                    <div class="game-info">Bet: 10 | Win: 50</div>
                </div>
                <div class="timer-section">
                    <div class="timer" data-timer="silver">5:00</div>
                    <div class="round-info">Round: <span data-round="silver">1</span></div>
                </div>
                <div class="winning-number" data-result="silver"></div>
                <div class="slots-info">Slots: <span data-slots="silver">0/6</span></div>
                <div class="your-bets">
                    <div class="bets-label">Your Bets:</div>
                    <div class="bet-numbers" data-mybets="silver">
                        <span style="color: #aaa; font-size: 13px;">No bets yet</span>
                    </div>
                </div>
                <div class="number-grid" data-grid="silver">
                    <button class="number-btn" data-number="0">0</button>
                    <button class="number-btn" data-number="1">1</button>
                    <button class="number-btn" data-number="2">2</button>
                    <button class="number-btn" data-number="3">3</button>
                    <button class="number-btn" data-number="4">4</button>
                    <button class="number-btn" data-number="5">5</button>
                    <button class="number-btn" data-number="6">6</button>
                    <button class="number-btn" data-number="7">7</button>
                    <button class="number-btn" data-number="8">8</button>
                    <button class="number-btn" data-number="9">9</button>
                </div>
                <div class="all-bets-list" data-bets="silver">
                    <div style="text-align: center; color: #aaa; padding: 10px;">No bets yet</div>
                </div>
                <div data-message="silver"></div>
            </div>
            
            <div class="game-card gold" data-game="gold">
                <div class="game-header">
                    <div class="game-title">ü•á Gold Game</div>
                    <div class="game-info">Bet: 50 | Win: 200</div>
                </div>
                <div class="timer-section">
                    <div class="timer" data-timer="gold">5:00</div>
                    <div class="round-info">Round: <span data-round="gold">1</span></div>
                </div>
                <div class="winning-number" data-result="gold"></div>
                <div class="slots-info">Slots: <span data-slots="gold">0/6</span></div>
                <div class="your-bets">
                    <div class="bets-label">Your Bets:</div>
                    <div class="bet-numbers" data-mybets="gold">
                        <span style="color: #aaa; font-size: 13px;">No bets yet</span>
                    </div>
                </div>
                <div class="number-grid" data-grid="gold">
                    <button class="number-btn" data-number="0">0</button>
                    <button class="number-btn" data-number="1">1</button>
                    <button class="number-btn" data-number="2">2</button>
                    <button class="number-btn" data-number="3">3</button>
                    <button class="number-btn" data-number="4">4</button>
                    <button class="number-btn" data-number="5">5</button>
                    <button class="number-btn" data-number="6">6</button>
                    <button class="number-btn" data-number="7">7</button>
                    <button class="number-btn" data-number="8">8</button>
                    <button class="number-btn" data-number="9">9</button>
                </div>
                <div class="all-bets-list" data-bets="gold">
                    <div style="text-align: center; color: #aaa; padding: 10px;">No bets yet</div>
                </div>
                <div data-message="gold"></div>
            </div>
            
            <div class="game-card diamond" data-game="diamond">
                <div class="game-header">
                    <div class="game-title">üíé Diamond Game</div>
                    <div class="game-info">Bet: 100 | Win: 500</div>
                </div>
                <div class="timer-section">
                    <div class="timer" data-timer="diamond">5:00</div>
                    <div class="round-info">Round: <span data-round="diamond">1</span></div>
                </div>
                <div class="winning-number" data-result="diamond"></div>
                <div class="slots-info">Slots: <span data-slots="diamond">0/6</span></div>
                <div class="your-bets">
                    <div class="bets-label">Your Bets:</div>
                    <div class="bet-numbers" data-mybets="diamond">
                        <span style="color: #aaa; font-size: 13px;">No bets yet</span>
                    </div>
                </div>
                <div class="number-grid" data-grid="diamond">
                    <button class="number-btn" data-number="0">0</button>
                    <button class="number-btn" data-number="1">1</button>
                    <button class="number-btn" data-number="2">2</button>
                    <button class="number-btn" data-number="3">3</button>
                    <button class="number-btn" data-number="4">4</button>
                    <button class="number-btn" data-number="5">5</button>
                    <button class="number-btn" data-number="6">6</button>
                    <button class="number-btn" data-number="7">7</button>
                    <button class="number-btn" data-number="8">8</button>
                    <button class="number-btn" data-number="9">9</button>
                </div>
                <div class="all-bets-list" data-bets="diamond">
                    <div style="text-align: center; color: #aaa; padding: 10px;">No bets yet</div>
                </div>
                <div data-message="diamond"></div>
            </div>
            
            <div class="game-card platinum" data-game="platinum">
                <div class="game-header">
                    <div class="game-title">‚≠ê Platinum Game</div>
                    <div class="game-info">Bet: 200 | Win: 1000</div>
                </div>
                <div class="timer-section">
                    <div class="timer" data-timer="platinum">5:00</div>
                    <div class="round-info">Round: <span data-round="platinum">1</span></div>
                </div>
                <div class="winning-number" data-result="platinum"></div>
                <div class="slots-info">Slots: <span data-slots="platinum">0/6</span></div>
                <div class="your-bets">
                    <div class="bets-label">Your Bets:</div>
                    <div class="bet-numbers" data-mybets="platinum">
                        <span style="color: #aaa; font-size: 13px;">No bets yet</span>
                    </div>
                </div>
                <div class="number-grid" data-grid="platinum">
                    <button class="number-btn" data-number="0">0</button>
                    <button class="number-btn" data-number="1">1</button>
                    <button class="number-btn" data-number="2">2</button>
                    <button class="number-btn" data-number="3">3</button>
                    <button class="number-btn" data-number="4">4</button>
                    <button class="number-btn" data-number="5">5</button>
                    <button class="number-btn" data-number="6">6</button>
                    <button class="number-btn" data-number="7">7</button>
                    <button class="number-btn" data-number="8">8</button>
                    <button class="number-btn" data-number="9">9</button>
                </div>
                <div class="all-bets-list" data-bets="platinum">
                    <div style="text-align: center; color: #aaa; padding: 10px;">No bets yet</div>
                </div>
                <div data-message="platinum"></div>
            </div>

            <div class="game-card roulette" data-game="roulette">
                <div class="game-header">
                    <div class="game-title">üé° Roulette Game</div>
                    <div class="game-info">Bet: 50 | Win: 1750 (35:1)</div>
                </div>
                <div class="timer-section">
                    <div class="timer" data-timer="roulette">5:00</div>
                    <div class="round-info">Round: <span data-round="roulette">1</span></div>
                </div>
                <div class="winning-number" data-result="roulette"></div>
                <div class="slots-info">Slots: <span data-slots="roulette">0/6</span></div>
                <div class="your-bets">
                    <div class="bets-label">Your Bets:</div>
                    <div class="bet-numbers" data-mybets="roulette">
                        <span style="color: #aaa; font-size: 13px;">No bets yet</span>
                    </div>
                </div>
                <div class="number-grid roulette-grid" data-grid="roulette">
                    <button class="number-btn roulette-btn" data-number="0">0</button>
                    <button class="number-btn roulette-btn" data-number="1">1</button>
                    <button class="number-btn roulette-btn" data-number="2">2</button>
                    <button class="number-btn roulette-btn" data-number="3">3</button>
                    <button class="number-btn roulette-btn" data-number="4">4</button>
                    <button class="number-btn roulette-btn" data-number="5">5</button>
                    <button class="number-btn roulette-btn" data-number="6">6</button>
                    <button class="number-btn roulette-btn" data-number="7">7</button>
                    <button class="number-btn roulette-btn" data-number="8">8</button>
                    <button class="number-btn roulette-btn" data-number="9">9</button>
                    <button class="number-btn roulette-btn" data-number="10">10</button>
                    <button class="number-btn roulette-btn" data-number="11">11</button>
                    <button class="number-btn roulette-btn" data-number="12">12</button>
                    <button class="number-btn roulette-btn" data-number="13">13</button>
                    <button class="number-btn roulette-btn" data-number="14">14</button>
                    <button class="number-btn roulette-btn" data-number="15">15</button>
                    <button class="number-btn roulette-btn" data-number="16">16</button>
                    <button class="number-btn roulette-btn" data-number="17">17</button>
                    <button class="number-btn roulette-btn" data-number="18">18</button>
                    <button class="number-btn roulette-btn" data-number="19">19</button>
                    <button class="number-btn roulette-btn" data-number="20">20</button>
                    <button class="number-btn roulette-btn" data-number="21">21</button>
                    <button class="number-btn roulette-btn" data-number="22">22</button>
                    <button class="number-btn roulette-btn" data-number="23">23</button>
                    <button class="number-btn roulette-btn" data-number="24">24</button>
                    <button class="number-btn roulette-btn" data-number="25">25</button>
                    <button class="number-btn roulette-btn" data-number="26">26</button>
                    <button class="number-btn roulette-btn" data-number="27">27</button>
                    <button class="number-btn roulette-btn" data-number="28">28</button>
                    <button class="number-btn roulette-btn" data-number="29">29</button>
                    <button class="number-btn roulette-btn" data-number="30">30</button>
                    <button class="number-btn roulette-btn" data-number="31">31</button>
                    <button class="number-btn roulette-btn" data-number="32">32</button>
                    <button class="number-btn roulette-btn" data-number="33">33</button>
                    <button class="number-btn roulette-btn" data-number="34">34</button>
                    <button class="number-btn roulette-btn" data-number="35">35</button>
                    <button class="number-btn roulette-btn" data-number="36">36</button>
                </div>
                <div class="all-bets-list" data-bets="roulette">
                    <div style="text-align: center; color: #aaa; padding: 10px;">No bets yet</div>
                </div>
                <div data-message="roulette"></div>
            </div>
        </div>
    </div>
    
    <script>
        let userId = localStorage.getItem('userId');
        if (!userId) {
            userId = 'user_' + Math.random().toString(36).substr(2, 9);
            localStorage.setItem('userId', userId);
        }
        
        const username = 'Player' + Math.floor(Math.random() * 9999);
        document.getElementById('username').textContent = username;
        
        const socket = io();
        
        fetch('/register', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({user_id: userId, username: username})
        })
        .then(res => res.json())
        .then(data => {
            document.getElementById('balance').textContent = data.balance;
        });
        
        const userBets = {
            silver: {},
            gold: {},
            diamond: {},
            platinum: {},
            roulette: {}
        };
        
        ['silver', 'gold', 'diamond', 'platinum', 'roulette'].forEach(gameType => {
            socket.emit('join_game', {game_type: gameType, user_id: userId});
            
            const grid = document.querySelector(`[data-grid="${gameType}"]`);
            grid.querySelectorAll('.number-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const number = parseInt(this.dataset.number);
                    const betCount = Object.keys(userBets[gameType]).length;
                    
                    if (betCount >= 4 && !userBets[gameType][number]) {
                        showMaxBetsModal();
                        return;
                    }
                    
                    placeBet(gameType, number);
                });
            });
        });
        
        function placeBet(gameType, number) {
            socket.emit('place_bet', {
                game_type: gameType,
                user_id: userId,
                username: username,
                number: number
            });
        }
        
        function updateRoundData(gameType, roundData) {
            if (!roundData) return;
            
            const bets = roundData.bets || [];
            const myBets = bets.filter(b => b.user_id === userId);
            
            document.querySelector(`[data-slots="${gameType}"]`).textContent = `${bets.length}/6`;
            
            const myBetsContainer = document.querySelector(`[data-mybets="${gameType}"]`);
            
            if (myBets.length === 0) {
                myBetsContainer.innerHTML = '<span style="color: #aaa; font-size: 13px;">No bets yet</span>';
                userBets[gameType] = {};
            } else {
                const betsHTML = myBets.map(bet => `<div class="bet-badge">${bet.number}</div>`).join('');
                myBetsContainer.innerHTML = betsHTML;
                
                userBets[gameType] = {};
                myBets.forEach(bet => {
                    userBets[gameType][bet.number] = true;
                });
            }
            
            const betsList = document.querySelector(`[data-bets="${gameType}"]`);
            if (bets.length === 0) {
                betsList.innerHTML = '<div style="text-align: center; color: #aaa; padding: 10px;">No bets yet</div>';
            } else {
                const isFinished = roundData.is_finished;
                const result = roundData.result;
                
                betsList.innerHTML = bets.map(bet => {
                    const isWinning = isFinished && bet.number === result && !bet.is_bot;
                    const classes = `bet-item ${bet.is_bot ? 'bot-bet' : ''} ${isWinning ? 'winning' : ''}`;
                    return `
                        <div class="${classes}">
                            <span>${bet.username}</span>
                            <span>Number ${bet.number}</span>
                        </div>
                    `;
                }).join('');
            }
            
            const grid = document.querySelector(`[data-grid="${gameType}"]`);
            grid.querySelectorAll('.number-btn').forEach(btn => {
                const num = parseInt(btn.dataset.number);
                const isMyBet = myBets.some(b => b.number === num);
                btn.classList.toggle('selected', isMyBet);
                btn.disabled = roundData.is_betting_closed;
            });
        }
        
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }
        
        function showMessage(gameType, message, isError = false) {
            const msgDiv = document.querySelector(`[data-message="${gameType}"]`);
            msgDiv.innerHTML = `<div class="message ${isError ? 'error' : 'success'}" style="display: block;">${message}</div>`;
            setTimeout(() => {
                msgDiv.innerHTML = '';
            }, 3000);
        }
        
        function showMaxBetsModal() {
            document.getElementById('maxBetsModal').classList.add('show');
        }
        
        function closeModal() {
            document.getElementById('maxBetsModal').classList.remove('show');
        }
        
        window.onclick = function(event) {
            const modal = document.getElementById('maxBetsModal');
            if (event.target == modal) {
                modal.classList.remove('show');
            }
        }
        
        socket.on('round_data', data => {
            updateRoundData(data.game_type, data.round_data);
        });
        
        socket.on('new_round', data => {
            const gameType = data.game_type;
            const roundNumber = data.round_number;
            
            userBets[gameType] = {};
            
            document.querySelector(`[data-round="${gameType}"]`).textContent = roundNumber;
            
            const resultDiv = document.querySelector(`[data-result="${gameType}"]`);
            resultDiv.classList.remove('show');
            resultDiv.textContent = '';
            
            const grid = document.querySelector(`[data-grid="${gameType}"]`);
            grid.querySelectorAll('.number-btn').forEach(btn => {
                btn.classList.remove('selected');
                btn.disabled = false;
            });
            
            updateRoundData(gameType, data.round_data);
        });
        
        socket.on('timer_update', data => {
            const timer = document.querySelector(`[data-timer="${data.game_type}"]`);
            const timeRemaining = data.betting_time_remaining || data.time_remaining;
            
            timer.textContent = formatTime(timeRemaining);
            timer.classList.remove('result-time');
            
            if (data.betting_time_remaining === 0 && data.time_remaining > 0) {
                timer.classList.add('result-time');
                timer.textContent = 'Result: ' + formatTime(data.time_remaining);
            }
        });
        
        socket.on('bet_placed', data => {
            updateRoundData(data.game_type, data.round_data);
        });
        
        socket.on('bet_success', data => {
            document.getElementById('balance').textContent = data.new_balance;
        });
        
        socket.on('bet_error', data => {
            ['silver', 'gold', 'diamond', 'platinum', 'roulette'].forEach(gt => {
                showMessage(gt, data.message, true);
            });
        });
        
        socket.on('betting_closed', data => {
            const grid = document.querySelector(`[data-grid="${data.game_type}"]`);
            grid.querySelectorAll('.number-btn').forEach(btn => {
                btn.disabled = true;
            });
        });
        
        socket.on('round_result', data => {
            const gameType = data.game_type;
            const resultDiv = document.querySelector(`[data-result="${gameType}"]`);
            
            const winners = data.winners || [];
            const isWinner = winners.some(w => w.user_id === userId);
            
            resultDiv.textContent = `üéØ Winning Number: ${data.result}`;
            
            if (isWinner) {
                const winAmount = winners.find(w => w.user_id === userId).payout;
                resultDiv.textContent = `üéâ YOU WIN! Number: ${data.result} +${winAmount} coins`;
                resultDiv.style.background = '#4ecca3';
                
                fetch(`/balance/${userId}`)
                    .then(res => res.json())
                    .then(balanceData => {
                        document.getElementById('balance').textContent = balanceData.balance;
                    });
            } else {
                resultDiv.style.background = '#c41e3a';
            }
            
            resultDiv.classList.add('show');
            
            const betsData = {
                ...data,
                bets: data.all_bets,
                is_betting_closed: true,
                is_finished: true,
                result: data.result
            };
            updateRoundData(gameType, betsData);
        });
    </script>
</body>
</html>
